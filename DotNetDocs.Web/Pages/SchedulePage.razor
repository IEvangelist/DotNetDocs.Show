@page "/schedule"
@attribute [AllowAnonymous]

@using DotNetDocs.Web.Extensions

@if (Shows == null)
{
    <LoadingIndicator />
}
else
{
    <table class="table table-hover pt-4">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Actions</th>
                <th scope="col">Title</th>
                <th scope="col" class="clickable" @onclick="@(_ => _orderDescending = !_orderDescending)">
                    Date &nbsp; <span class='oi oi-chevron-@(_orderDescending ? "bottom" : "top")'></span>
                </th>
                <th scope="col">
                    Guests &nbsp; <span class="all-devs"></span>
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var show in
                _orderDescending ? Shows.OrderByDescending(s => s.Date) : Shows.OrderBy(s => s.Date))
            {
                var isPlaceholder = show.IsPlaceholder;
                <tr>
                    <td>
                        @if (isPlaceholder)
                        {
                            var date = show.Date!.Value;
                            var dateRoute = $"{date.Month:00}-{date.Day:00}-{date.Year}".Encrypt(ProtectionProvider!);
                            <button class="btn btn-sm btn-dotnet"
                                    @onclick='@(_ => Navigation.NavigateTo($"/request/{dateRoute}"))'>
                                Request
                            </button>
                        }
                    </td>
                    <td>
                        @if (isPlaceholder)
                        {
                            <span>Submit a topic, and maybe you'll be our guest!</span>
                        }
                        else
                        {
                            @(show.Title)
                        }
                    </td>
                    <td>@($"{show.Date:MMM dd, yyyy hh:mm (zzzz)}")</td>
                    <td>
                        @if (isPlaceholder)
                        {
                            <span>You?!</span>
                        }
                        else
                        {
                            @(new MarkupString(show.Guests.ToCommaSeparatedString(true)))
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
